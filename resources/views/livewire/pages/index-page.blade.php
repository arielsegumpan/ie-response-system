<div>
    <!-- Features -->
    <div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
        <div class="aspect-w-16 aspect-h-7">
            <div id="hs-pin-leaflet" class="h-100 hs-leaflet z-10 rounded-[1rem] ring-1 ring-neutral-600 dark:ring-neutral-500"></div>
        </div>

        <!-- Grid -->
        <div class="mt-5 lg:mt-16 grid lg:grid-cols-3 gap-8 l   g:gap-12">
        <div class="lg:col-span-1">
            <h2 class="font-bold text-2xl md:text-3xl text-gray-800 dark:text-neutral-200">
           Lorem ipsum, dolor sit amet consectetur adipisicing
            </h2>
            <p class="mt-2 md:mt-4 text-gray-500 dark:text-neutral-500">
            Lorem ipsum dolor sit, amet consectetur adipisicing elit. Ut vitae voluptate minus doloremque? Debitis doloribus, blanditiis eos eum ratione atque.
            </p>
        </div>
        <!-- End Col -->

        <div class="lg:col-span-2">
            <div class="grid sm:grid-cols-2 gap-8 md:gap-12">
            <!-- Icon Block -->
            <div class="flex gap-x-5">
                <svg class="shrink-0 mt-1 size-6 text-red-600 dark:text-red-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="10" x="3" y="11" rx="2"/><circle cx="12" cy="5" r="2"/><path d="M12 7v4"/><line x1="8" x2="8" y1="16" y2="16"/><line x1="16" x2="16" y1="16" y2="16"/></svg>
                <div class="grow">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                   Lorem, ipsum
                </h3>
                <p class="mt-1 text-gray-600 dark:text-neutral-400">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Repellendus dolorem ipsa odio.
                </p>
                </div>
            </div>
            <!-- End Icon Block -->

            <!-- Icon Block -->
            <div class="flex gap-x-5">
                <svg class="shrink-0 mt-1 size-6 text-red-600 dark:text-red-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></svg>
                <div class="grow">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                    Lorem, ipsum dolor
                </h3>
                <p class="mt-1 text-gray-600 dark:text-neutral-400">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Repellendus dolorem ipsa odio.
                </p>
                </div>
            </div>
            <!-- End Icon Block -->

            <!-- Icon Block -->
            <div class="flex gap-x-5">
                <svg class="shrink-0 mt-1 size-6 text-red-600 dark:text-red-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                <div class="grow">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                   Lorem, ipsum dolor
                </h3>
                <p class="mt-1 text-gray-600 dark:text-neutral-400">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Repellendus dolorem ipsa odio.
                </p>
                </div>
            </div>
            <!-- End Icon Block -->

            <!-- Icon Block -->
            <div class="flex gap-x-5">
                <svg class="shrink-0 mt-1 size-6 text-red-600 dark:text-red-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                <div class="grow">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">
                    Lorem, ipsum dolor
                </h3>
                <p class="mt-1 text-gray-600 dark:text-neutral-400">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Repellendus dolorem ipsa odio.
                </p>
                </div>
            </div>
            <!-- End Icon Block -->
            </div>
        </div>
        <!-- End Col -->
        </div>
        <!-- End Grid -->
    </div>
    <!-- End Features -->

    <!-- Icon Blocks -->
    <div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
        <div class="grid sm:grid-cols-2 lg:grid-cols-3 items-center gap-6">
        <!-- Card -->
        <a class="group flex gap-y-6 size-full hover:bg-gray-100 focus:outline-hidden focus:bg-gray-100 rounded-lg p-5 dark:hover:bg-neutral-800 dark:focus:bg-neutral-800" href="#">
            <svg class="shrink-0 size-8 text-gray-800 mt-0.5 me-6 dark:text-neutral-200" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>

            <div>
            <div>
                <h3 class="block font-bold text-gray-800 dark:text-white">Build your portfolio</h3>
                <p class="text-gray-600 dark:text-neutral-400">The simplest way to keep your portfolio always up-to-date.</p>
            </div>

            <p class="mt-3 inline-flex items-center gap-x-1 text-sm font-semibold text-gray-800 dark:text-neutral-200">
                Learn more
                <svg class="shrink-0 size-4 transition ease-in-out group-hover:translate-x-1 group-focus:translate-x-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </p>
            </div>
        </a>
        <!-- End Card -->

        <!-- Card -->
        <a class="group flex gap-y-6 size-full hover:bg-gray-100 focus:outline-hidden focus:bg-gray-100 rounded-lg p-5 dark:hover:bg-neutral-800 dark:focus:bg-neutral-800" href="#">
            <svg class="shrink-0 size-8 text-gray-800 mt-0.5 me-6 dark:text-neutral-200" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h20"/><path d="M21 3v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3"/><path d="m7 21 5-5 5 5"/></svg>

            <div>
            <div>
                <h3 class="block font-bold text-gray-800 dark:text-white">Get freelance work</h3>
                <p class="text-gray-600 dark:text-neutral-400">New design projects delivered to your inbox each morning.</p>
            </div>

            <p class="mt-3 inline-flex items-center gap-x-1 text-sm font-semibold text-gray-800 dark:text-neutral-200">
                Learn more
                <svg class="shrink-0 size-4 transition ease-in-out group-hover:translate-x-1 group-focus:translate-x-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </p>
            </div>
        </a>
        <!-- End Card -->

        <!-- Card -->
        <a class="group flex gap-y-6 size-full hover:bg-gray-100 focus:outline-hidden focus:bg-gray-100 rounded-lg p-5 dark:hover:bg-neutral-800 dark:focus:bg-neutral-800" href="#">
            <svg class="shrink-0 size-8 text-gray-800 mt-0.5 me-6 dark:text-neutral-200" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></svg>

            <div>
            <div>
                <h3 class="block font-bold text-gray-800 dark:text-white">Sell your goods</h3>
                <p class="text-gray-600 dark:text-neutral-400">Get your goods in front of millions of potential customers with ease.</p>
            </div>

            <p class="mt-3 inline-flex items-center gap-x-1 text-sm font-semibold text-gray-800 dark:text-neutral-200">
                Learn more
                <svg class="shrink-0 size-4 transition ease-in-out group-hover:translate-x-1 group-focus:translate-x-1" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
            </p>
            </div>
        </a>
        <!-- End Card -->
        </div>
    </div>
    <!-- End Icon Blocks -->


    <!-- Card Blog -->
    <div class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto">
        <!-- Title -->
        <div class="max-w-2xl text-center mx-auto mb-10 lg:mb-14">
            <h2 class="text-2xl font-bold md:text-4xl md:leading-tight dark:text-white">Read our latest news and blogs</h2>
            <p class="mt-1 text-gray-600 dark:text-neutral-400">Lorem ipsum dolor sit amet consectetur adipisicing elit. Maxime mollitia, molestiae quas vel sint commodi repudiandae distinctio quisquam repellat.</p>
        </div>
        <!-- End Title -->

        <!-- Grid -->
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10 lg:mb-14">
            @if (count($featuredPosts) != 0)
            @foreach ($featuredPosts as $featPost)
            <!-- Card -->
            <a wire:key="blog-{{ $featPost->id }}" class="group flex flex-col bg-white border border-gray-200 shadow-2xs rounded-xl hover:shadow-md focus:outline-hidden focus:shadow-md transition dark:bg-neutral-900 dark:border-neutral-800" href="{{ route('page.blog.show', $featPost->slug) }}">
                <div class="aspect-w-16 aspect-h-9">
                <img class="w-full object-cover rounded-t-xl h-[300px] lg:h-[200px] md:h-[250px]" src="{{ asset(Storage::url($featPost->featured_img)) }}" alt="{{ $featPost->title }}">
                </div>
                <div class="p-4 md:p-5">
                <p class="mt-2 text-xs uppercase text-gray-600 dark:text-neutral-400">
                    {{ $featPost->categories->first()->cat_name ?? 'Uncategorized' }}
                </p>
                <h3 class="mt-2 text-lg font-medium text-gray-800 group-hover:text-red-600 dark:text-neutral-300 dark:group-hover:text-white">
                    {{ $featPost->title }}
                </h3>
                </div>
            </a>
            <!-- End Card -->
            @endforeach
            @else
            <div class="col-span-1 col-span-4">
                <h2 class="text-lg text-center font-bold text-gray-600 dark:text-neutral-400">{{ __('No Featured Posts') }}</h2>
            </div>
            @endif
    </div>
    <!-- End Card Blog -->


    @push('scripts')
        <script>
            let mostRecentMarker = null;

            window.incidents = @json($incidents);
            window.addEventListener('load', () => {
                const map = L.map('hs-pin-leaflet', {
                    center: [10.901002750609775, 123.07139009929351],
                    zoom: 13,
                });

                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    minZoom: 2,
                    attribution: 'Â© OpenStreetMap contributors'
                }).addTo(map);

                function createPopupContent(inc_name, incident_number, created_at, status, imageArray) {
                    let imagesHtml = '';
                    if (Array.isArray(imageArray)) {
                        imagesHtml = imageArray.map(img => {
                            return `<img class="inline-block size-8 rounded-lg object-cover ring-2 mt-2 ring-white dark:ring-nuetral-400" src="${img.image_url}" alt="Incident Image">`;
                        }).join('');
                    }
                    return `
                        <div class="max-w-[12rem]">
                            <a href="/incidents/${incident_number}">
                                <h3 class="text-lg font-bold text-red-600">
                                    ${inc_name.toUpperCase()}
                                </h3>
                            </a>

                            <div class="flex items-center justify-between items-center align-middle">



                                <div>
                                    <div class="text-sm text-gray-500 dark:text-neutral-500">
                                        ${created_at}
                                    </div>
                                    <div class="mt-1">
                                        <small>
                                            <span class="inline-flex items-center gap-x-1.5 px-3 rounded-md text-xs font-medium border ${getStatusClass(status)}">
                                                ${status.toUpperCase().replace('_', ' ')}
                                            </span>
                                        </small>
                                    </div>
                                </div>
                                 <div class="flex -space-x-2">
                                    ${imagesHtml}
                                </div>

                            </div>
                        </div>
                    `;
                }

                function getStatusClass(status) {
                    switch (status.toLowerCase()) {
                        case 'resolved':
                            return 'border-green-500 text-green-500';
                        case 'pending':
                        case 'in_progress':
                            return 'border-yellow-500 text-yellow-500';
                        default:
                            return 'border-red-500 text-red-500';
                    }
                }

                // Add dynamic markers
                if (window.incidents) {
                    window.incidents.forEach((incident, index) => {
                        if (incident.location.latitude && incident.location.longitude) {
                            const marker = L.marker([incident.location.latitude, incident.location.longitude])
                                .bindPopup(createPopupContent(
                                    incident.type.inc_name,
                                    incident.incident_number,
                                    incident.formatted_created_at,
                                    incident.status,
                                    incident.images
                                ))
                                .addTo(map);

                            // ðŸ”¥ Store the first marker as most recent
                            if (index === 0) {
                                mostRecentMarker = marker;
                            }
                        }
                    });

                    // ðŸ”¥ Open popup for the most recent incident
                    if (mostRecentMarker) {
                        mostRecentMarker.openPopup();
                    }
                }
            });
        </script>


    @endpush

</div>
